define(["jquery","core/chartjs","report_usage/color"],function(a,b,c){function d(a,b){var c=[],d=JSON.parse(window.localStorage.getItem("report_usage_visibility_"+h));for(var e in a){var f=!0;null!==d&&d[e]===!1&&(f=!1),c.push({objid:e,fill:!1,label:b[e],hidden:f,data:a[e],borderColor:g[c.length%g.length]})}return c}function e(a){var b=a.config.data.datasets,c={};for(var d in b){var e=b[d];c[e.objid]=!a.isDatasetVisible(d)}window.localStorage.setItem("report_usage_visibility_"+h,JSON.stringify(c))}function f(f,i,j,k){g=c.createColors(),h=k;var l=a("#report_usage_chart"),m=l.get(0).getContext("2d"),n=new b(m,{type:"line",data:{labels:i,datasets:d(f,j)},options:{onClick:function(){setTimeout(e,200,n)},onResize:function(){setTimeout(function(){l.height=n.legend.bottom+400,l.css("height",l.height+"px")},20)},maintainAspectRatio:!1}});l.height=n.legend.bottom+400,l.css("height",l.height+"px")}var g,h;return{init:f}});